{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/gaelc/Desktop/examenIngWeb/gael/gael/frontend/src/app/conciertos/create/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { useAuth } from \"@/src/hooks/useAuth\";\r\n\r\ntype Geocode = {\r\n  _id: string;\r\n  address: string;\r\n  lat: number;\r\n  lon: number;\r\n};\r\n\r\nexport default function CreateConciertoPage() {\r\n  const router = useRouter();\r\n  const { user } = useAuth();\r\n\r\n  const [ciudad, setCiudad] = useState(\"\"); // we will store the chosen place here too\r\n  const [addressQuery, setAddressQuery] = useState(\"\"); // what user types to geocode\r\n  const [geocode, setGeocode] = useState<Geocode | null>(null);\r\n\r\n  const [fecha, setFecha] = useState<string>(\"\"); // datetime-local\r\n\r\n  const [geoLoading, setGeoLoading] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [geoError, setGeoError] = useState<string | null>(null);\r\n\r\n  const fetchGeocode = async () => {\r\n    setGeoError(null);\r\n    setError(null);\r\n    setGeocode(null);\r\n\r\n    const q = addressQuery.trim();\r\n    if (!q) {\r\n      setGeoError(\"Escribe una ciudad/dirección para buscar.\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setGeoLoading(true);\r\n      const base = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:8080\";\r\n      const url = `${base}/api/geocodes/address/${encodeURIComponent(q)}`;\r\n\r\n      const res = await fetch(url, { method: \"GET\", credentials: \"include\" });\r\n      if (!res.ok) {\r\n        const text = await res.text().catch(() => \"\");\r\n        throw new Error(`HTTP ${res.status} ${text}`);\r\n      }\r\n\r\n      const data = (await res.json()) as Geocode;\r\n      setGeocode(data);\r\n\r\n      // Use the resolved address as \"ciudad\" display value by default\r\n      setCiudad(data.address);\r\n    } catch (e: any) {\r\n      setGeoError(e?.message || \"Error buscando coordenadas\");\r\n    } finally {\r\n      setGeoLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError(null);\r\n\r\n    if (!user?.email) return setError(\"Debes iniciar sesión para crear un concierto.\");\r\n    if (!fecha) return setError(\"La fecha es obligatoria.\");\r\n    if (!geocode) return setError(\"Debes buscar y seleccionar un lugar (geocoding) antes de crear.\");\r\n    if (!ciudad.trim()) return setError(\"La ciudad/lugar es obligatorio.\");\r\n\r\n    try {\r\n      setLoading(true);\r\n\r\n      const base = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:8080\";\r\n      const res = await fetch(`${base}/api/conciertos`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        credentials: \"include\",\r\n        body: JSON.stringify({\r\n          ciudad: ciudad.trim(),\r\n          lat: geocode.lat,\r\n          lon: geocode.lon,\r\n          fecha: new Date(fecha).toISOString(),\r\n          creador: user.email,\r\n        }),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const text = await res.text().catch(() => \"\");\r\n        throw new Error(`Backend error (${res.status}) ${text}`);\r\n      }\r\n\r\n      router.push(\"/conciertos\");\r\n      router.refresh();\r\n    } catch (err: any) {\r\n      setError(err?.message || \"Error creando el concierto\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-900/95 backdrop-blur-md py-12 px-4 sm:px-6 lg:px-8\">\r\n      <div className=\"max-w-2xl mx-auto\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-bold text-white\">Crear concierto</h1>\r\n          <p className=\"text-slate-400 mt-1\">\r\n            Primero elige un lugar (geocoding), luego selecciona fecha.\r\n          </p>\r\n        </div>\r\n\r\n        <form\r\n          onSubmit={handleSubmit}\r\n          className=\"bg-slate-900/60 border border-slate-800 rounded-2xl p-6 shadow space-y-5\"\r\n        >\r\n          {/* Geocoding */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-slate-200 mb-2\">\r\n              Buscar lugar (ciudad/dirección)\r\n            </label>\r\n            <div className=\"flex gap-2\">\r\n              <input\r\n                value={addressQuery}\r\n                onChange={(e) => setAddressQuery(e.target.value)}\r\n                placeholder=\"Ej: Malaga / Plaza Mayor Madrid / etc...\"\r\n                className=\"w-full rounded-lg bg-slate-950/40 border border-slate-700 text-slate-100 px-3 py-2 outline-none focus:ring-2 focus:ring-purple-500/60\"\r\n              />\r\n              <button\r\n                type=\"button\"\r\n                onClick={fetchGeocode}\r\n                disabled={geoLoading}\r\n                className=\"px-4 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 disabled:opacity-60 text-slate-100 font-medium transition-colors\"\r\n              >\r\n                {geoLoading ? \"Buscando...\" : \"Buscar\"}\r\n              </button>\r\n            </div>\r\n\r\n            {geoError && (\r\n              <div className=\"mt-3 bg-red-950/40 border border-red-800 rounded-xl p-4 text-red-200\">\r\n                {geoError}\r\n              </div>\r\n            )}\r\n\r\n            {geocode && (\r\n              <div className=\"mt-3 bg-slate-950/40 border border-slate-800 rounded-xl p-4 text-slate-200 space-y-2\">\r\n                <div className=\"text-sm text-slate-300\">\r\n                  Resultado: <span className=\"text-slate-100 font-medium\">{geocode.address}</span>\r\n                </div>\r\n                <div className=\"text-sm text-slate-300\">\r\n                  Lat/Lon:{\" \"}\r\n                  <span className=\"text-slate-100 font-medium\">\r\n                    {geocode.lat}, {geocode.lon}\r\n                  </span>\r\n                </div>\r\n\r\n                <div className=\"pt-2\">\r\n                  <label className=\"block text-sm font-medium text-slate-200 mb-2\">\r\n                    Ciudad/Lugar (se guardará en el concierto)\r\n                  </label>\r\n                  <input\r\n                    value={ciudad}\r\n                    onChange={(e) => setCiudad(e.target.value)}\r\n                    className=\"w-full rounded-lg bg-slate-900/60 border border-slate-700 text-slate-100 px-3 py-2 outline-none focus:ring-2 focus:ring-purple-500/60\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Fecha */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-slate-200 mb-2\">\r\n              Fecha y hora\r\n            </label>\r\n            <input\r\n              type=\"datetime-local\"\r\n              value={fecha}\r\n              onChange={(e) => setFecha(e.target.value)}\r\n              className=\"w-full rounded-lg bg-slate-950/40 border border-slate-700 text-slate-100 px-3 py-2 outline-none focus:ring-2 focus:ring-purple-500/60\"\r\n            />\r\n            <p className=\"text-xs text-slate-400 mt-2\">\r\n              Se guardará en UTC (ISO string) en la base de datos.\r\n            </p>\r\n          </div>\r\n\r\n          {error && (\r\n            <div className=\"bg-red-950/40 border border-red-800 rounded-xl p-4 text-red-200\">\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex items-center gap-3\">\r\n            <button\r\n              type=\"submit\"\r\n              disabled={loading}\r\n              className=\"px-4 py-2 rounded-lg bg-purple-600 hover:bg-purple-700 disabled:opacity-60 disabled:cursor-not-allowed text-white font-medium transition-colors\"\r\n            >\r\n              {loading ? \"Creando...\" : \"Crear concierto\"}\r\n            </button>\r\n\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => router.push(\"/conciertos\")}\r\n              className=\"px-4 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-100 font-medium transition-colors\"\r\n            >\r\n              Cancelar\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}