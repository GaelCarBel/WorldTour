{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/gaelc/Desktop/examenIngWeb/gael/gael/frontend/src/app/reservas/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport { useAuth } from \"@/src/hooks/useAuth\";\r\n\r\ntype Reserva = {\r\n  _id: string;\r\n  concierto: string | { _id: string };\r\n  userEmail: string;\r\n  token: string;\r\n  iat: string;\r\n  exp: string;\r\n};\r\n\r\ntype Concierto = {\r\n  _id: string;\r\n  ciudad: string;\r\n  fecha: string;\r\n};\r\n\r\ntype Gira = {\r\n  _id: string;\r\n  grupo: string;\r\n  posterUri: string;\r\n  conciertos: string[];\r\n};\r\n\r\ntype ReservaView = {\r\n  _id: string;\r\n  grupo: string | null;\r\n  posterUri: string | null;\r\n  ciudad: string | null;\r\n  fecha: string | null;\r\n  token: string;\r\n  iat: string;\r\n  exp: string;\r\n};\r\n\r\nexport default function MisReservasPage() {\r\n  const { user } = useAuth();\r\n\r\n  const [items, setItems] = useState<ReservaView[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    const load = async () => {\r\n      try {\r\n        setLoading(true);\r\n        setError(null);\r\n\r\n        if (!user?.email) {\r\n          setItems([]);\r\n          setLoading(false);\r\n          return;\r\n        }\r\n\r\n        const base = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:8080\";\r\n\r\n        const [rRes, cRes, gRes] = await Promise.all([\r\n          fetch(`${base}/api/reservas`, { credentials: \"include\" }),\r\n          fetch(`${base}/api/conciertos`, { credentials: \"include\" }),\r\n          fetch(`${base}/api/giras`, { credentials: \"include\" }),\r\n        ]);\r\n\r\n        if (!rRes.ok) throw new Error(await rRes.text().catch(() => \"Error cargando reservas\"));\r\n        if (!cRes.ok) throw new Error(await cRes.text().catch(() => \"Error cargando conciertos\"));\r\n        if (!gRes.ok) throw new Error(await gRes.text().catch(() => \"Error cargando giras\"));\r\n\r\n        const reservas = (await rRes.json()) as Reserva[];\r\n        const conciertos = (await cRes.json()) as Concierto[];\r\n        const giras = (await gRes.json()) as Gira[];\r\n\r\n        const myEmail = user.email.toLowerCase();\r\n\r\n        \r\n        const conciertoMap = new Map<string, Concierto>();\r\n        (Array.isArray(conciertos) ? conciertos : []).forEach((c) => conciertoMap.set(c._id, c));\r\n\r\n        \r\n        const conciertoToGira = new Map<string, { grupo: string; posterUri: string }>();\r\n        (Array.isArray(giras) ? giras : []).forEach((g) => {\r\n          (Array.isArray(g.conciertos) ? g.conciertos : []).forEach((cid) => {\r\n            if (!conciertoToGira.has(cid)) {\r\n              conciertoToGira.set(cid, { grupo: g.grupo, posterUri: g.posterUri });\r\n            }\r\n          });\r\n        });\r\n\r\n        const mine = (Array.isArray(reservas) ? reservas : [])\r\n          .filter((r) => (r.userEmail || \"\").toLowerCase() === myEmail)\r\n          .map((r): ReservaView => {\r\n            const cid = typeof r.concierto === \"string\" ? r.concierto : r.concierto?._id;\r\n            const concierto = cid ? conciertoMap.get(cid) : undefined;\r\n            const giraInfo = cid ? conciertoToGira.get(cid) : undefined;\r\n\r\n            return {\r\n              _id: r._id,\r\n              grupo: giraInfo?.grupo ?? null,\r\n              posterUri: giraInfo?.posterUri ?? null,\r\n              ciudad: concierto?.ciudad ?? null,\r\n              fecha: concierto?.fecha ?? null,\r\n              token: r.token,\r\n              iat: r.iat,\r\n              exp: r.exp,\r\n            };\r\n          });\r\n\r\n       \r\n        mine.sort((a, b) => {\r\n          const ta = a.fecha ? new Date(a.fecha).getTime() : 0;\r\n          const tb = b.fecha ? new Date(b.fecha).getTime() : 0;\r\n          return ta - tb;\r\n        });\r\n\r\n        setItems(mine);\r\n      } catch (e: any) {\r\n        setError(e?.message || \"Error cargando mis reservas\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    load();\r\n  }, [user?.email]);\r\n\r\n  const total = useMemo(() => items.length, [items]);\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-900/95 backdrop-blur-md py-12 px-4 sm:px-6 lg:px-8\">\r\n      <div className=\"max-w-6xl mx-auto\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-bold text-white\">Mis reservas</h1>\r\n          <p className=\"text-slate-300 text-sm\">\r\n            {loading ? \"Cargando...\" : `Total: ${total}`}\r\n          </p>\r\n        </div>\r\n\r\n        {!user?.email && !loading && (\r\n          <div className=\"bg-slate-900/60 border border-slate-800 rounded-xl p-6 text-slate-300\">\r\n            Debes iniciar sesión para ver tus reservas.\r\n          </div>\r\n        )}\r\n\r\n        {loading && (\r\n          <div className=\"bg-slate-900/60 border border-slate-800 rounded-xl p-6 text-slate-300\">\r\n            Cargando reservas...\r\n          </div>\r\n        )}\r\n\r\n        {error && !loading && (\r\n          <div className=\"bg-red-950/40 border border-red-800 rounded-xl p-6 text-red-200\">\r\n            Error: {error}\r\n          </div>\r\n        )}\r\n\r\n        {!loading && !error && user?.email && items.length === 0 && (\r\n          <div className=\"bg-slate-900/60 border border-slate-800 rounded-xl p-6 text-slate-300\">\r\n            No tienes reservas todavía.\r\n          </div>\r\n        )}\r\n\r\n        {!loading && !error && items.length > 0 && (\r\n          <div className=\"grid gap-5 sm:grid-cols-2 lg:grid-cols-3\">\r\n            {items.map((r) => (\r\n              <div\r\n                key={r._id}\r\n                className=\"bg-slate-900/60 border border-slate-800 rounded-2xl overflow-hidden shadow\"\r\n              >\r\n                <div className=\"w-full h-56 bg-slate-800\">\r\n                  {r.posterUri ? (\r\n                    <img\r\n                      src={r.posterUri}\r\n                      alt={r.grupo ?? \"Poster\"}\r\n                      className=\"w-full h-full object-cover\"\r\n                      loading=\"lazy\"\r\n                    />\r\n                  ) : null}\r\n                </div>\r\n\r\n                <div className=\"p-4\">\r\n                  <h2 className=\"text-lg font-semibold text-white\">\r\n                    {r.grupo ?? \"Sin gira\"}\r\n                  </h2>\r\n\r\n                  <div className=\"mt-2 text-sm text-slate-300 space-y-1\">\r\n                    <div>\r\n                      Ciudad:{\" \"}\r\n                      <span className=\"text-slate-100 font-medium\">{r.ciudad ?? \"—\"}</span>\r\n                    </div>\r\n                    <div>\r\n                      Fecha:{\" \"}\r\n                      <span className=\"text-slate-100 font-medium\">\r\n                        {r.fecha ? new Date(r.fecha).toLocaleString() : \"—\"}\r\n                      </span>\r\n                    </div>\r\n\r\n                    <div className=\"pt-2 text-xs break-all\">\r\n                      Token: <span className=\"text-slate-100\">{r.token}</span>\r\n                    </div>\r\n                    <div className=\"text-xs\">\r\n                      iat:{\" \"}\r\n                      <span className=\"text-slate-100\">\r\n                        {r.iat ? new Date(r.iat).toLocaleString() : \"—\"}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"text-xs\">\r\n                      exp:{\" \"}\r\n                      <span className=\"text-slate-100\">\r\n                        {r.exp ? new Date(r.exp).toLocaleString() : \"—\"}\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"mt-4\">\r\n                    <span className=\"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-purple-600/20 text-purple-200 border border-purple-600/30\">\r\n                      Reserva\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}