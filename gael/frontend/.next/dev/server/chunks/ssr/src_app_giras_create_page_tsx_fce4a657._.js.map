{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/gaelc/Desktop/examenIngWeb/gael/gael/frontend/src/app/giras/create/page.tsx"],"sourcesContent":["\r\n\"use client\";\r\n\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { useAuth } from \"@/src/hooks/useAuth\";\r\n\r\ntype CloudinaryUploadResponse = {\r\n  secure_url: string;\r\n  public_id: string;\r\n};\r\n\r\nexport default function CreateGiraPage() {\r\n  const router = useRouter();\r\n  const { user } = useAuth();\r\n\r\n  const [grupo, setGrupo] = useState(\"\");\r\n  const [file, setFile] = useState<File | null>(null);\r\n\r\n  const [loading, setLoading] = useState(false);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const previewUrl = useMemo(() => {\r\n    if (!file) return null;\r\n    return URL.createObjectURL(file);\r\n  }, [file]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (previewUrl) URL.revokeObjectURL(previewUrl);\r\n    };\r\n  }, [previewUrl]);\r\n\r\n  const uploadToCloudinary = async (imageFile: File): Promise<string> => {\r\n    const cloudName = process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME;\r\n    const uploadPreset = process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET;\r\n\r\n    if (!cloudName) throw new Error(\"Missing NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME\");\r\n    if (!uploadPreset) throw new Error(\"Missing NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET\");\r\n\r\n    const form = new FormData();\r\n    form.append(\"file\", imageFile);\r\n    form.append(\"upload_preset\", uploadPreset);\r\n    form.append(\"folder\", \"worldtour/giras\");\r\n\r\n    setUploading(true);\r\n    try {\r\n      const res = await fetch(\r\n        `https://api.cloudinary.com/v1_1/${cloudName}/image/upload`,\r\n        {\r\n          method: \"POST\",\r\n          body: form,\r\n        }\r\n      );\r\n\r\n      if (!res.ok) {\r\n        const text = await res.text().catch(() => \"\");\r\n        throw new Error(`Cloudinary upload failed (${res.status}) ${text}`);\r\n      }\r\n\r\n      const data = (await res.json()) as CloudinaryUploadResponse;\r\n      if (!data.secure_url) throw new Error(\"Cloudinary did not return secure_url\");\r\n      return data.secure_url;\r\n    } finally {\r\n      setUploading(false);\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError(null);\r\n\r\n    if (!grupo.trim()) return setError(\"El nombre del grupo es obligatorio.\");\r\n    if (!file) return setError(\"Selecciona una imagen para el p贸ster.\");\r\n    if (!user?.email) return setError(\"Debes iniciar sesi贸n para crear una gira.\");\r\n\r\n    try {\r\n      setLoading(true);\r\n\r\n      \r\n      const posterUri = await uploadToCloudinary(file);\r\n\r\n     \r\n      const base = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:8080\";\r\n      const res = await fetch(`${base}/api/giras`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        credentials: \"include\",\r\n        body: JSON.stringify({\r\n          grupo: grupo.trim(),\r\n          posterUri,\r\n          creador: user.email,\r\n        }),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const text = await res.text().catch(() => \"\");\r\n        throw new Error(`Backend error (${res.status}) ${text}`);\r\n      }\r\n\r\n      router.push(\"/giras\");\r\n      router.refresh();\r\n    } catch (err: any) {\r\n      setError(err?.message || \"Error creando la gira\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-900/95 backdrop-blur-md py-12 px-4 sm:px-6 lg:px-8\">\r\n      <div className=\"max-w-2xl mx-auto\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-bold text-white\">Crear gira</h1>\r\n          <p className=\"text-slate-400 mt-1\">Nombre del grupo + imagen del p贸ster</p>\r\n        </div>\r\n\r\n        <form\r\n          onSubmit={handleSubmit}\r\n          className=\"bg-slate-900/60 border border-slate-800 rounded-2xl p-6 shadow space-y-5\"\r\n        >\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-slate-200 mb-2\">\r\n              Grupo\r\n            </label>\r\n            <input\r\n              value={grupo}\r\n              onChange={(e) => setGrupo(e.target.value)}\r\n              placeholder=\"Ej: Megadeth\"\r\n              className=\"w-full rounded-lg bg-slate-950/40 border border-slate-700 text-slate-100 px-3 py-2 outline-none focus:ring-2 focus:ring-purple-500/60\"\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-slate-200 mb-2\">\r\n              P贸ster (imagen)\r\n            </label>\r\n            <input\r\n              type=\"file\"\r\n              accept=\"image/*\"\r\n              onChange={(e) => setFile(e.target.files?.[0] ?? null)}\r\n              className=\"block w-full text-slate-200 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-slate-800 file:text-slate-100 hover:file:bg-slate-700\"\r\n            />\r\n\r\n            {previewUrl && (\r\n              <div className=\"mt-3 rounded-xl overflow-hidden border border-slate-800\">\r\n                <img\r\n                  src={previewUrl}\r\n                  alt=\"Preview\"\r\n                  className=\"w-full h-56 object-cover\"\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {error && (\r\n            <div className=\"bg-red-950/40 border border-red-800 rounded-xl p-4 text-red-200\">\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex items-center gap-3\">\r\n            <button\r\n              type=\"submit\"\r\n              disabled={loading || uploading}\r\n              className=\"px-4 py-2 rounded-lg bg-purple-600 hover:bg-purple-700 disabled:opacity-60 disabled:cursor-not-allowed text-white font-medium transition-colors\"\r\n            >\r\n              {uploading ? \"Subiendo imagen...\" : loading ? \"Creando...\" : \"Crear gira\"}\r\n            </button>\r\n\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => router.push(\"/giras\")}\r\n              className=\"px-4 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-100 font-medium transition-colors\"\r\n            >\r\n              Cancelar\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAGA;AACA;AACA;AAJA;;;;;AAWe,SAAS;IACtB,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,EAAE,IAAI,EAAE,GAAG,IAAA,kIAAO;IAExB,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAC;IACnC,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAc;IAE9C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC3C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAgB;IAElD,MAAM,aAAa,IAAA,gNAAO,EAAC;QACzB,IAAI,CAAC,MAAM,OAAO;QAClB,OAAO,IAAI,eAAe,CAAC;IAC7B,GAAG;QAAC;KAAK;IAET,IAAA,kNAAS,EAAC;QACR,OAAO;YACL,IAAI,YAAY,IAAI,eAAe,CAAC;QACtC;IACF,GAAG;QAAC;KAAW;IAEf,MAAM,qBAAqB,OAAO;QAChC,MAAM;QACN,MAAM;QAEN;;QACA;;QAEA,MAAM,OAAO,IAAI;QACjB,KAAK,MAAM,CAAC,QAAQ;QACpB,KAAK,MAAM,CAAC,iBAAiB;QAC7B,KAAK,MAAM,CAAC,UAAU;QAEtB,aAAa;QACb,IAAI;YACF,MAAM,MAAM,MAAM,MAChB,CAAC,gCAAgC,EAAE,UAAU,aAAa,CAAC,EAC3D;gBACE,QAAQ;gBACR,MAAM;YACR;YAGF,IAAI,CAAC,IAAI,EAAE,EAAE;gBACX,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM;gBAC1C,MAAM,IAAI,MAAM,CAAC,0BAA0B,EAAE,IAAI,MAAM,CAAC,EAAE,EAAE,MAAM;YACpE;YAEA,MAAM,OAAQ,MAAM,IAAI,IAAI;YAC5B,IAAI,CAAC,KAAK,UAAU,EAAE,MAAM,IAAI,MAAM;YACtC,OAAO,KAAK,UAAU;QACxB,SAAU;YACR,aAAa;QACf;IACF;IAEA,MAAM,eAAe,OAAO;QAC1B,EAAE,cAAc;QAChB,SAAS;QAET,IAAI,CAAC,MAAM,IAAI,IAAI,OAAO,SAAS;QACnC,IAAI,CAAC,MAAM,OAAO,SAAS;QAC3B,IAAI,CAAC,MAAM,OAAO,OAAO,SAAS;QAElC,IAAI;YACF,WAAW;YAGX,MAAM,YAAY,MAAM,mBAAmB;YAG3C,MAAM,OAAO,6DAAmC;YAChD,MAAM,MAAM,MAAM,MAAM,GAAG,KAAK,UAAU,CAAC,EAAE;gBAC3C,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,aAAa;gBACb,MAAM,KAAK,SAAS,CAAC;oBACnB,OAAO,MAAM,IAAI;oBACjB;oBACA,SAAS,KAAK,KAAK;gBACrB;YACF;YAEA,IAAI,CAAC,IAAI,EAAE,EAAE;gBACX,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM;gBAC1C,MAAM,IAAI,MAAM,CAAC,eAAe,EAAE,IAAI,MAAM,CAAC,EAAE,EAAE,MAAM;YACzD;YAEA,OAAO,IAAI,CAAC;YACZ,OAAO,OAAO;QAChB,EAAE,OAAO,KAAU;YACjB,SAAS,KAAK,WAAW;QAC3B,SAAU;YACR,WAAW;QACb;IACF;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAG,WAAU;sCAAgC;;;;;;sCAC9C,8OAAC;4BAAE,WAAU;sCAAsB;;;;;;;;;;;;8BAGrC,8OAAC;oBACC,UAAU;oBACV,WAAU;;sCAEV,8OAAC;;8CACC,8OAAC;oCAAM,WAAU;8CAAgD;;;;;;8CAGjE,8OAAC;oCACC,OAAO;oCACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;oCACxC,aAAY;oCACZ,WAAU;;;;;;;;;;;;sCAId,8OAAC;;8CACC,8OAAC;oCAAM,WAAU;8CAAgD;;;;;;8CAGjE,8OAAC;oCACC,MAAK;oCACL,QAAO;oCACP,UAAU,CAAC,IAAM,QAAQ,EAAE,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE,IAAI;oCAChD,WAAU;;;;;;gCAGX,4BACC,8OAAC;oCAAI,WAAU;8CACb,cAAA,8OAAC;wCACC,KAAK;wCACL,KAAI;wCACJ,WAAU;;;;;;;;;;;;;;;;;wBAMjB,uBACC,8OAAC;4BAAI,WAAU;sCACZ;;;;;;sCAIL,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCACC,MAAK;oCACL,UAAU,WAAW;oCACrB,WAAU;8CAET,YAAY,uBAAuB,UAAU,eAAe;;;;;;8CAG/D,8OAAC;oCACC,MAAK;oCACL,SAAS,IAAM,OAAO,IAAI,CAAC;oCAC3B,WAAU;8CACX;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQb"}}]
}